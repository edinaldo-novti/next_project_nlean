# ==============================================================================
# Traefik (root Coolify) - Dynamic config: novti.net e *.novti.net → sub-server
# Com Cloudflare: tráfego pode chegar em HTTP (Flexible) ou HTTPS (Full/Strict).
# ==============================================================================

http:
  routers:
    # HTTPS (Cloudflare Full ou Full Strict → root recebe em 443)
    novti-router-https:
      rule: "Host(`novti.net`) || HostRegexp(`{subdomain:.+}.novti.net`)"
      entryPoints:
        - websecure
      service: novti-subserver
      priority: 10
      tls:
        certResolver: letsencrypt

    # HTTP (Cloudflare Flexible → root recebe em 80; sem TLS)
    novti-router-http:
      rule: "Host(`novti.net`) || HostRegexp(`{subdomain:.+}.novti.net`)"
      entryPoints:
        - web
      service: novti-subserver
      priority: 10

  services:
    novti-subserver:
      loadBalancer:
        servers:
          - url: "http://192.168.3.40:80"
        passHostHeader: true
